<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>WebXR AR Video</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

<style>
body { margin: 0; overflow: hidden; background: black; }
#ui {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  background: rgba(0,0,0,.6);
  padding: 10px;
  border-radius: 10px;
}
button, input {
  font-size: 16px;
  color: white;
}
</style>
</head>

<body>

<div id="ui">
  <input type="file" id="videoInput" accept="video/*"><br><br>
  <button id="startAR">START AR</button>
</div>

<a-scene
  renderer="colorManagement: true"
  vr-mode-ui="enabled: false"
  embedded>

  <a-assets>
    <video id="video" loop playsinline webkit-playsinline crossorigin="anonymous"></video>
  </a-assets>

  <a-camera position="0 1.6 0"></a-camera>

  <a-entity
    id="screen"
    geometry="primitive: plane; width: 1.6; height: 0.9"
    material="shader: flat; src: #video"
    position="0 1.5 -2"
    visible="false">
  </a-entity>

</a-scene>

<script>
const input = document.getElementById("videoInput");
const video = document.getElementById("video");
const screen = document.getElementById("screen");
const startBtn = document.getElementById("startAR");
const scene = document.querySelector("a-scene");

let videoReady = false;

input.onchange = () => {
  const file = input.files[0];
  if (!file) return;

  video.src = URL.createObjectURL(file);
  video.muted = false;
  video.play();
  videoReady = true;
};

startBtn.onclick = async () => {
  if (!videoReady) {
    alert("Сначала выбери видео");
    return;
  }

  if (!navigator.xr) {
    alert("WebXR не поддерживается");
    return;
  }

  try {
    await scene.renderer.xr.setSession(
      await navigator.xr.requestSession("immersive-ar", {
        requiredFeatures: ["local-floor"]
      })
    );

    screen.setAttribute("visible", true);
  } catch (e) {
    alert("Ошибка запуска AR");
    console.error(e);
  }
};
</script>

</body>
</html>

