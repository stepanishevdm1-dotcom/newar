<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Fake AR Video</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body, html { margin:0; padding:0; overflow:hidden; background:black; }
  video#cam { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; }
  video#videoLayer {
    position:absolute;
    top:50%; left:50%;
    width:200px; height:auto;
    transform: translate(-50%,-50%) scale(1);
    touch-action: none;
    display:block;
    z-index:10;
  }
  #ui { position:fixed; bottom:10px; left:50%; transform:translateX(-50%);
       z-index:20; background: rgba(0,0,0,0.6); padding:10px; border-radius:10px;
       color:white; }
  input { font-size:16px; }
</style>
</head>
<body>

<div id="ui">
  <input type="file" id="videoInput" accept="video/*">
</div>

<video id="cam" autoplay muted playsinline></video>
<video id="videoLayer" loop muted playsinline webkit-playsinline></video>

<script>
const cam = document.getElementById('cam');
const videoLayer = document.getElementById('videoLayer');
const input = document.getElementById('videoInput');

// Камера
navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}, audio:false})
.then(stream => { cam.srcObject = stream; })
.catch(e => alert('Не удалось включить камеру: ' + e));

// Загрузка видео
input.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  videoLayer.src = url;
  videoLayer.muted = false; // звук включаем
  videoLayer.play().catch(err => console.log('Ошибка воспроизведения:', err));
});

// Перетаскивание и масштаб
let posX=0, posY=0, startX=0, startY=0, scale=1;
let startDistance=null;

videoLayer.addEventListener('touchstart', e=>{
  if(e.touches.length===1){
    startX = e.touches[0].clientX - posX;
    startY = e.touches[0].clientY - posY;
  } else if(e.touches.length===2){
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    startDistance = Math.hypot(dx,dy)/scale;
  }
}, {passive:false});

videoLayer.addEventListener('touchmove', e=>{
  e.preventDefault();
  if(e.touches.length===1){
    posX = e.touches[0].clientX - startX;
    posY = e.touches[0].clientY - startY;
  } else if(e.touches.length===2 && startDistance){
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    scale = Math.hypot(dx,dy)/startDistance;
  }
  videoLayer.style.transform = `translate(calc(-50% + ${posX}px), calc(-50% + ${posY}px)) scale(${scale})`;
}, {passive:false});

videoLayer.addEventListener('touchend', e=>{
  if(e.touches.length < 2) startDistance=null;
});
</script>

</body>
</html>
