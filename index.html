<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>AR Video WORKING</title>

<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

<style>
body { margin:0; overflow:hidden; }
#videoTime {
  position: fixed;
  top: 10px;
  right: 10px;
  color: white;
  background: rgba(0,0,0,0.6);
  padding: 4px 8px;
  border-radius: 6px;
  font-family: monospace;
  z-index: 999;
}
#fileInput {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 999;
}
video { display:none; }
</style>
</head>
<body>

<input id="fileInput" type="file" accept="video/*">
<div id="videoTime">00:00 / 00:00</div>

<!-- Скрытое видео -->
<video id="videoEl" loop playsinline crossorigin="anonymous" muted></video>

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled:false">

  <!-- Камера + курсор с fuse -->
  <a-entity camera look-controls>
    <a-cursor
      fuse="true"
      fuse-timeout="3000"
      geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.03"
      material="color: white; shader: flat">
    </a-cursor>
  </a-entity>

  <!-- Видео в AR -->
  <a-video
    id="videoPlane"
    src="#videoEl"
    visible="false"
    position="0 0 -2"
    width="2"
    height="1.2">
  </a-video>

  <!-- Кнопки -->
  <a-entity id="buttons" position="0 -1.2 -2" visible="false">
    <a-plane class="clickable" color="#00ff00" position="-0.9 0 0" width="0.5" height="0.25"
      text="value: Play; align:center; width:0.45; color:#000" play-btn></a-plane>

    <a-plane class="clickable" color="#ffff00" position="-0.3 0 0" width="0.5" height="0.25"
      text="value: Pause; align:center; width:0.45; color:#000" pause-btn></a-plane>

    <a-plane class="clickable" color="#00ffff" position="0.3 0 0" width="0.5" height="0.25"
      text="value: +5; align:center; width:0.45; color:#000" plus-btn></a-plane>

    <a-plane class="clickable" color="#ff00ff" position="0.9 0 0" width="0.5" height="0.25"
      text="value: -5; align:center; width:0.45; color:#000" minus-btn></a-plane>
  </a-entity>

</a-scene>

<script>
const videoEl = document.getElementById('videoEl');
const videoPlane = document.getElementById('videoPlane');
const buttons = document.getElementById('buttons');
const timeEl = document.getElementById('videoTime');
const fileInput = document.getElementById('fileInput');

// Загрузка видео
fileInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;

  videoEl.src = URL.createObjectURL(file);
  videoEl.load();
  videoEl.play();

  videoPlane.setAttribute('visible', true);
  buttons.setAttribute('visible', true);
};

// Таймер
setInterval(() => {
  if (!videoEl) return;
  const f = t => `${Math.floor(t/60).toString().padStart(2,'0')}:${Math.floor(t%60).toString().padStart(2,'0')}`;
  timeEl.textContent = `${f(videoEl.currentTime)} / ${isNaN(videoEl.duration) ? '00:00' : f(videoEl.duration)}`;
}, 300);

// Fuse-кнопки
AFRAME.registerComponent('play-btn', { init() { this.el.addEventListener('fuse', () => videoEl.play()); } });
AFRAME.registerComponent('pause-btn', { init() { this.el.addEventListener('fuse', () => videoEl.pause()); } });
AFRAME.registerComponent('plus-btn', { init() { this.el.addEventListener('fuse', () => videoEl.currentTime += 5); } });
AFRAME.registerComponent('minus-btn', { init() { this.el.addEventListener('fuse', () => videoEl.currentTime -= 5); } });
</script>

</body>
</html>
