<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>AR Video с кнопками и таймером</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

<style>
body { margin:0; overflow:hidden; }
#videoTime {
  position: fixed;
  top: 10px;
  right: 10px;
  color: white;
  background: rgba(0,0,0,0.6);
  padding: 4px 8px;
  border-radius: 6px;
  font-family: monospace;
  z-index: 999;
}
#fileInput {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 999;
}
#sizeSliderContainer {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.5);
  padding: 5px 10px;
  border-radius: 5px;
  z-index: 999;
}
</style>
</head>

<body>

<input id="fileInput" type="file" accept="video/*">
<div id="videoTime">00:00 / 00:00</div>
<div id="sizeSliderContainer">
  <label style="color:white;">Video Size:</label>
  <input type="range" id="sizeSlider" min="0.2" max="5" step="0.05" value="1">
</div>

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled:false">

  <!-- Камера с fuse -->
  <a-entity camera look-controls>
    <a-cursor fuse="true" fuse-timeout="3000"
      geometry="primitive:ring; radiusInner:0.015; radiusOuter:0.025"
      material="color:white; shader:flat">
    </a-cursor>
  </a-entity>

  <!-- Видео -->
  <a-video id="videoPlane" visible="false" position="0 0 -2" width="1.2" height="0.7"></a-video>

  <!-- Кнопки -->
  <a-entity id="buttons" position="0 -0.6 -2" visible="false">

    <a-plane class="btn" color="#00ff00" position="-0.6 0 0" width="0.35" height="0.15"
      text="value: Play; align:center" cursor-listener="action:play"></a-plane>

    <a-plane class="btn" color="#ffff00" position="-0.2 0 0" width="0.35" height="0.15"
      text="value: Pause; align:center" cursor-listener="action:pause"></a-plane>

    <a-plane class="btn" color="#00ffff" position="0.2 0 0" width="0.35" height="0.15"
      text="value: +5; align:center" cursor-listener="action:plus"></a-plane>

    <a-plane class="btn" color="#ff00ff" position="0.6 0 0" width="0.35" height="0.15"
      text="value: -5; align:center" cursor-listener="action:minus"></a-plane>

  </a-entity>

</a-scene>

<script>
const videoPlane = document.getElementById('videoPlane');
const buttons = document.getElementById('buttons');
const fileInput = document.getElementById('fileInput');
const timeEl = document.getElementById('videoTime');
const sizeSlider = document.getElementById('sizeSlider');

let videoEl;

// Загрузка видео
fileInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;

  videoEl = document.createElement('video');
  videoEl.src = URL.createObjectURL(file);
  videoEl.loop = true;
  videoEl.playsInline = true;
  videoEl.crossOrigin = 'anonymous';

  videoPlane.setAttribute('src', videoEl);
  videoPlane.setAttribute('visible', true);
  buttons.setAttribute('visible', true);

  videoEl.play();
};

// Обновление времени видео
setInterval(() => {
  if (!videoEl) return;
  const f = t => `${Math.floor(t/60).toString().padStart(2,'0')}:${Math.floor(t%60).toString().padStart(2,'0')}`;
  timeEl.textContent = `${f(videoEl.currentTime)} / ${f(videoEl.duration||0)}`;
}, 200);

// Масштабирование видео и кнопок
sizeSlider.addEventListener('input', ()=>{
  const scale = parseFloat(sizeSlider.value);
  videoPlane.setAttribute('scale', `${scale} ${scale} ${scale}`);
  buttons.setAttribute('scale', `${scale} ${scale} ${scale}`);
});

// Движение кнопок вместе с видео
AFRAME.registerComponent('follow-video', {
  tick: function () {
    const pos = videoPlane.getAttribute('position');
    if (pos) buttons.setAttribute('position', {x: pos.x, y: pos.y - 0.6, z: pos.z});
  }
});
document.querySelector('a-scene').setAttribute('follow-video','');

// Компоненты кнопок для gaze
AFRAME.registerComponent('cursor-listener', {
  schema: {action:{type:'string'}},
  init: function () {
    this.el.addEventListener('click', () => {
      if (!videoEl) return;
      switch(this.data.action){
        case 'play': videoEl.play(); break;
        case 'pause': videoEl.pause(); break;
        case 'plus': videoEl.currentTime = Math.min(videoEl.duration, videoEl.currentTime+5); break;
        case 'minus': videoEl.currentTime = Math.max(0, videoEl.currentTime-5); break;
      }
    });
  }
});
</script>

</body>
</html>
