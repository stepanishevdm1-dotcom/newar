<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>AR Video WORKING</title>

<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

<style>
body { margin:0; overflow:hidden; }
#videoTime {
  position: fixed;
  top: 10px;
  right: 10px;
  color: white;
  background: rgba(0,0,0,0.6);
  padding: 4px 8px;
  border-radius: 6px;
  font-family: monospace;
  z-index: 999;
}
#fileInput {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 999;
}
</style>
</head>

<body>

<input id="fileInput" type="file" accept="video/*">
<div id="videoTime">00:00 / 00:00</div>

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled:false">

  <!-- КАМЕРА + КУРСОР С FUSE -->
  <a-entity camera look-controls>
    <a-cursor
      fuse="true"
      fuse-timeout="3000"
      geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.025"
      material="color: white; shader: flat">
    </a-cursor>
  </a-entity>

  <!-- ВИДЕО -->
  <a-video
    id="videoPlane"
    visible="false"
    position="0 0 -2"
    width="1.2"
    height="0.7"
    rotation="0 0 0"
    material="shader: flat; side: double">
  </a-video>

  <!-- КНОПКИ -->
  <a-entity id="buttons" position="0 -0.6 -2" visible="false">

    <a-plane class="btn" color="#00ff00" position="-0.6 0 0" width="0.4" height="0.2"
      text="value: Play; align:center; width:2"
      play-btn></a-plane>

    <a-plane class="btn" color="#ffff00" position="-0.2 0 0" width="0.4" height="0.2"
      text="value: Pause; align:center; width:2"
      pause-btn></a-plane>

    <a-plane class="btn" color="#00ffff" position="0.2 0 0" width="0.4" height="0.2"
      text="value: +5; align:center; width:2"
      plus-btn></a-plane>

    <a-plane class="btn" color="#ff00ff" position="0.6 0 0" width="0.4" height="0.2"
      text="value: -5; align:center; width:2"
      minus-btn></a-plane>

  </a-entity>

</a-scene>

<script>
let videoEl;
const videoPlane = document.getElementById('videoPlane');
const buttons = document.getElementById('buttons');
const timeEl = document.getElementById('videoTime');
const fileInput = document.getElementById('fileInput');

// Загрузка видео
fileInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;

  videoEl = document.createElement('video');
  videoEl.src = URL.createObjectURL(file);
  videoEl.loop = true;
  videoEl.playsInline = true;
  videoEl.crossOrigin = 'anonymous';
  videoEl.muted = true; // нужно для autoplay в браузерах

  // Ждём, пока метаданные видео загрузятся
  videoEl.addEventListener('loadedmetadata', () => {
    videoPlane.setAttribute('src', videoEl);
    videoPlane.setAttribute('visible', true);
    buttons.setAttribute('visible', true);

    videoEl.play();
  });
};

// Обновление таймера каждые 300 мс
setInterval(() => {
  if (!videoEl) return;
  const f = t => `${Math.floor(t/60).toString().padStart(2,'0')}:${Math.floor(t%60).toString().padStart(2,'0')}`;
  timeEl.textContent = `${f(videoEl.currentTime)} / ${isNaN(videoEl.duration) ? '00:00' : f(videoEl.duration)}`;
}, 300);

// Кнопки через fuse (3 секунды удержания)
AFRAME.registerComponent('play-btn', {
  init() { this.el.addEventListener('fuse', () => videoEl && videoEl.play()); }
});
AFRAME.registerComponent('pause-btn', {
  init() { this.el.addEventListener('fuse', () => videoEl && videoEl.pause()); }
});
AFRAME.registerComponent('plus-btn', {
  init() { this.el.addEventListener('fuse', () => videoEl && (videoEl.currentTime += 5)); }
});
AFRAME.registerComponent('minus-btn', {
  init() { this.el.addEventListener('fuse', () => videoEl && (videoEl.currentTime -= 5)); }
});
</script>

</body>
</html>
