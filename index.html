<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>AR Video Mobile Ready</title>

<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

<style>
body { margin:0; overflow:hidden; }
#videoTime {
  position: fixed;
  top: 10px;
  right: 10px;
  color: white;
  background: rgba(0,0,0,0.6);
  padding: 6px 10px;
  border-radius: 6px;
  font-family: monospace;
  z-index: 999;
}
#fileInput {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 999;
}
</style>
</head>

<body>

<input id="fileInput" type="file" accept="video/*">
<div id="videoTime">00:00 / 00:00</div>

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled:false">

  <!-- Видео как ресурс -->
  <a-assets>
    <video id="videoAsset" playsinline webkit-playsinline muted></video>
  </a-assets>

  <!-- Камера с fuse-курсором -->
  <a-entity camera look-controls>
    <a-cursor
      fuse="true"
      fuse-timeout="3000"
      raycaster="objects: .clickable"
      geometry="primitive:ring; radiusInner:0.015; radiusOuter:0.025"
      material="color:white; shader:flat">
    </a-cursor>
  </a-entity>

  <!-- Видео-плоскость -->
  <a-video
    id="videoPlane"
    src="#videoAsset"
    visible="false"
    position="0 0 -2"
    width="1.2"
    height="0.7"
    rotation="0 180 0">
  </a-video>

  <!-- Кнопки управления -->
  <a-entity id="buttons" position="0 -0.4 -2" visible="false">
    <a-plane class="clickable" color="#00ff00" position="-0.6 0 0" width="0.35" height="0.15"
             text="value:Play;align:center" play-btn></a-plane>
    <a-plane class="clickable" color="#ffff00" position="-0.2 0 0" width="0.35" height="0.15"
             text="value:Pause;align:center" pause-btn></a-plane>
    <a-plane class="clickable" color="#00ffff" position="0.2 0 0" width="0.35" height="0.15"
             text="value:+5;align:center" plus-btn></a-plane>
    <a-plane class="clickable" color="#ff00ff" position="0.6 0 0" width="0.35" height="0.15"
             text="value:-5;align:center" minus-btn></a-plane>
  </a-entity>

</a-scene>

<script>
const videoEl = document.getElementById('videoAsset');
const videoPlane = document.getElementById('videoPlane');
const buttons = document.getElementById('buttons');
const timeEl = document.getElementById('videoTime');
const fileInput = document.getElementById('fileInput');

// 1️⃣ Подготовка видео после выбора
fileInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;

  videoEl.src = URL.createObjectURL(file);
  videoEl.loop = true;
  videoEl.muted = true; // обязательно для мобильного Chrome
  videoEl.setAttribute('muted', '');
  videoEl.playsInline = true;

  // Показываем видео и кнопки сразу, но play будет через fuse
  videoPlane.setAttribute('visible', true);
  buttons.setAttribute('visible', true);
};

// 2️⃣ Таймер текущего времени / длительности
setInterval(() => {
  if (!videoEl.duration) return;

  const f = t =>
    `${Math.floor(t/60).toString().padStart(2,'0')}:${Math.floor(t%60).toString().padStart(2,'0')}`;

  timeEl.textContent = `${f(videoEl.currentTime)} / ${f(videoEl.duration)}`;
}, 300);

// 3️⃣ Компоненты кнопок с fuse (через click после 3 сек удержания)
AFRAME.registerComponent('play-btn', {
  init() { this.el.addEventListener('click', () => videoEl.play()); }
});
AFRAME.registerComponent('pause-btn', {
  init() { this.el.addEventListener('click', () => videoEl.pause()); }
});
AFRAME.registerComponent('plus-btn', {
  init() { this.el.addEventListener('click', () => videoEl.currentTime += 5); }
});
AFRAME.registerComponent('minus-btn', {
  init() { this.el.addEventListener('click', () => videoEl.currentTime -= 5); }
});
</script>

</body>
</html>
