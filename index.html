<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR –í–∏–¥–µ–æ —Å –∫–Ω–æ–ø–∫–æ–π —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { 
            margin:0; 
            overflow:hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        #fileInput {
            position:fixed; 
            top:15px; 
            left:50%; 
            transform:translateX(-50%); 
            z-index:10;
            background: rgba(255,255,255,0.95);
            color:#2c3e50;
            padding:12px 25px;
            border-radius:50px;
            border:2px solid #3498db;
            font-size:14px;
            font-weight:600;
            cursor:pointer;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            transition: all 0.3s ease;
        }
        
        #fileInput:hover {
            background: white;
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            transform: translateX(-50%) scale(1.05);
        }
        
        /* –£–í–ï–õ–ò–ß–ò–õ –∫–Ω–æ–ø–∫–∏ */
        #placeBtn {
            position:fixed; 
            bottom:20px; 
            left:50%;
            transform:translateX(-50%); 
            z-index:10;
            background: linear-gradient(135deg, #3498db 0%, #2ecc71 100%);
            color:white;
            padding:20px 50px; /* –£–í–ï–õ–ò–ß–ï–ù–û */
            border-radius:50px;
            font-size:20px; /* –£–í–ï–õ–ò–ß–ï–ù–û */
            font-weight:600;
            cursor:pointer;
            border:none;
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            min-width: 200px; /* –£–í–ï–õ–ò–ß–ï–ù–û */
        }
        
        #placeBtn:hover {
            transform: translateX(-50%) scale(1.08);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.6);
        }
        
        #videoTime {
            position: fixed; 
            top: 15px; 
            right: 15px;
            color: white; 
            background: rgba(0,0,0,0.7);
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            font-family: monospace;
            z-index: 10;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ - –£–í–ï–õ–ò–ß–ï–ù–´ */
        #controls {
            position: fixed;
            bottom: 90px; /* –ü–æ–¥–Ω—è–ª –≤—ã—à–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–Ω–æ–ø–æ–∫ */
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: flex;
            gap: 15px;
        }
        
        .control-btn {
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
            border: none;
            padding: 20px 25px; /* –£–í–ï–õ–ò–ß–ï–ù–û */
            border-radius: 15px;
            font-size: 20px; /* –£–í–ï–õ–ò–ß–ï–ù–û */
            cursor: pointer;
            min-width: 70px; /* –£–í–ï–õ–ò–ß–ï–ù–û */
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background: white;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <input type="file" id="fileInput" accept="video/*" />
    
    <div id="controls">
        <button class="control-btn" id="playBtn">‚ñ∂</button>
        <button class="control-btn" id="pauseBtn">‚è∏</button>
        <button class="control-btn" id="stopBtn">‚èπ</button>
    </div>
    
    <button id="placeBtn">üìç –†–∞–∑–º–µ—Å—Ç–∏—Ç—å</button>
    
    <div id="videoTime">00:00 / 00:00</div>
    
    <!-- AR-—Å—Ü–µ–Ω–∞ -->
    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false;"
        renderer="antialias: true; alpha: true"
        embedded
    >
        <a-assets>
            <video id="videoSource" autoplay loop crossorigin="anonymous" style="display:none;"></video>
        </a-assets>
        
        <!-- –ú–∞—Ä–∫–µ—Ä –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤–∏–¥–µ–æ -->
        <a-marker id="videoMarker" type="pattern" preset="custom" url="data/marker.patt" visible="false">
            <a-video 
                id="arVideo"
                src="#videoSource"
                width="2" 
                height="1.125"
                position="0 0 0"
                rotation="-90 0 0"
                transparent="true"
                visible="false"
                material="shader: flat; side: front;" /* –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–Ω–æ –æ—Ç–∑–µ—Ä–∫–∞–ª–∏–≤–∞–Ω–∏–µ */
            ></a-video>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const fileInput = document.getElementById('fileInput');
        const videoTime = document.getElementById('videoTime');
        const placeBtn = document.getElementById('placeBtn');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã A-Frame
        const arVideo = document.getElementById('arVideo');
        const videoSource = document.getElementById('videoSource');
        const videoMarker = document.getElementById('videoMarker');
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–∞ —Å —Ç–∞–π–º–µ—Ä–æ–º
        let lastUpdateTime = 0;
        let isPlaying = false;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const videoURL = URL.createObjectURL(file);
            videoSource.src = videoURL;
            
            videoSource.onloadeddata = function() {
                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ê–ì–ê: –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
                startTimerUpdate();
                updateVideoTime();
            };
        });
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ê–ì–ê –° –¢–ê–ô–ú–ï–†–û–ú: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
        function startTimerUpdate() {
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –µ—Å–ª–∏ –±—ã–ª
            if (window.timerInterval) {
                clearInterval(window.timerInterval);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—ã–µ 100–º—Å
            window.timerInterval = setInterval(function() {
                if (videoSource.duration) {
                    updateVideoTime();
                }
            }, 100);
        }
        
        function updateVideoTime() {
            const current = videoSource.currentTime || 0;
            const total = videoSource.duration || 0;
            
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };
            
            videoTime.textContent = `${formatTime(current)} / ${formatTime(total)}`;
        }
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ê–ì–ê –° –û–¢–ó–ï–†–ö–ê–õ–ò–í–ê–ù–ò–ï–ú: –§–∏–∫—Å–∏—Ä—É–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã –≤–∏–¥–µ–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
        let originalWidth = 2;
        let originalHeight = 1.125;
        
        // –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤–∏–¥–µ–æ –≤ AR
        arVideo.addEventListener('componentchanged', function(e) {
            if (e.detail.name === 'rotation' || e.detail.name === 'scale') {
                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
                arVideo.setAttribute('width', originalWidth);
                arVideo.setAttribute('height', originalHeight);
                
                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–±–µ–¥–∏–º—Å—è —á—Ç–æ –≤–∏–¥–µ–æ –Ω–µ –∑–µ—Ä–∫–∞–ª–∏—Ç—Å—è
                arVideo.setAttribute('material', 'shader: flat; side: front;');
            }
        });
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ
        playBtn.addEventListener('click', () => {
            if (videoSource.src) {
                videoSource.play();
                isPlaying = true;
            }
        });
        
        pauseBtn.addEventListener('click', () => {
            if (videoSource.src) {
                videoSource.pause();
                isPlaying = false;
            }
        });
        
        stopBtn.addEventListener('click', () => {
            if (videoSource.src) {
                videoSource.pause();
                videoSource.currentTime = 0;
                isPlaying = false;
                updateVideoTime();
            }
        });
        
        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –≤–∏–¥–µ–æ –≤ AR
        placeBtn.addEventListener('click', () => {
            if (!videoSource.src) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ!');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ –∏ –º–∞—Ä–∫–µ—Ä
            arVideo.setAttribute('visible', 'true');
            videoMarker.setAttribute('visible', 'true');
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
            arVideo.setAttribute('width', originalWidth);
            arVideo.setAttribute('height', originalHeight);
            arVideo.setAttribute('material', 'shader: flat; side: front;');
            
            // –ù–∞—á–∏–Ω–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
            videoSource.play();
            isPlaying = true;
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            startTimerUpdate();
        });
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è play/pause –¥–ª—è —Ç–∞–π–º–µ—Ä–∞
        videoSource.addEventListener('play', function() {
            isPlaying = true;
            startTimerUpdate(); // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        });
        
        videoSource.addEventListener('pause', function() {
            isPlaying = false;
        });
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—Ä—É—á–Ω—É—é
        videoSource.addEventListener('timeupdate', function() {
            updateVideoTime();
        });
    </script>
</body>
</html>
