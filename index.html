<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>AR Видео с кнопкой разместить</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
<style>
body { margin:0; overflow:hidden; background: #111; font-family: sans-serif; }
#fileInput {
    position:fixed; top:15px; left:50%; transform:translateX(-50%); z-index:10;
    background: rgba(255,255,255,0.95); color:#2c3e50;
    padding:15px 35px; border-radius:50px; border:2px solid #3498db;
    font-size:16px; font-weight:600; cursor:pointer; box-shadow:0 4px 15px rgba(52,152,219,0.3);
    transition: all 0.3s ease;
}
#fileInput:hover {
    background: white; transform: translateX(-50%) scale(1.05);
}
#placeBtn {
    position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
    z-index:10; background: linear-gradient(135deg, #3498db, #2ecc71);
    color:white; padding:20px 50px; border-radius:50px; font-size:20px;
    font-weight:700; cursor:pointer; border:none; box-shadow:0 6px 20px rgba(46,204,113,0.4);
    transition: all 0.3s ease;
}
#placeBtn:hover { transform: translateX(-50%) scale(1.1); }
#videoTime {
    position:fixed; top:15px; right:15px; color:white;
    background: rgba(0,0,0,0.7); padding:10px 20px; border-radius:10px;
    font-size:16px; font-weight:600;
}
</style>
</head>
<body>

<input type="file" id="fileInput" accept="video/*">
<div id="videoTime">00:00</div>
<button id="placeBtn">Разместить видео</button>

<a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
    <a-marker preset="hiro">
        <a-video id="arVideo" src="" width="4" height="2.25" position="0 1 0" rotation="0 0 0" autoplay="false" loop="true"></a-video>
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>

<script>
const fileInput = document.getElementById('fileInput');
const videoEl = document.getElementById('arVideo');
const placeBtn = document.getElementById('placeBtn');
const videoTime = document.getElementById('videoTime');

let timerInterval;
let videoLoaded = false;

fileInput.addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const url = URL.createObjectURL(file);
    videoEl.setAttribute('src', url);
    videoEl.setAttribute('autoplay', true);
    videoLoaded = true;
    videoEl.components.material.material.map.image.play();
    startTimer();
});

placeBtn.addEventListener('click', ()=>{
    if(videoLoaded){
        const video = videoEl.components.material.material.map.image;
        if(video.paused) video.play();
        else video.pause();
    }
});

function startTimer(){
    clearInterval(timerInterval);
    timerInterval = setInterval(()=>{
        const video = videoEl.components.material.material.map.image;
        if(video && !video.paused){
            const sec = Math.floor(video.currentTime);
            const m = Math.floor(sec/60).toString().padStart(2,'0');
            const s = (sec%60).toString().padStart(2,'0');
            videoTime.innerText = `${m}:${s}`;
        }
    }, 200);
}

// Исправление зеркального отображения и сжатия
videoEl.setAttribute('scale', '1 1 1'); // убираем -1 по оси
videoEl.setAttribute('rotation', '0 0 0'); // прямое видео
</script>
</body>
</html>
